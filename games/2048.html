<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #121212;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            touch-action: manipulation;
        }

        .container {
            max-width: 500px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px 0;
            border-bottom: 1px solid #333;
        }

        h1 {
            font-size: 2rem;
            color: #bb86fc;
        }

        .settings {
            display: flex;
            gap: 15px;
        }

        .language-selector {
            display: flex;
            gap: 8px;
            background: #1e1e1e;
            padding: 5px;
            border-radius: 6px;
        }

        .lang-btn {
            background: #333;
            color: #e0e0e0;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .lang-btn:hover {
            background: #444;
        }

        .lang-btn.active {
            background: #bb86fc;
            color: #121212;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }

        .score-container {
            display: flex;
            gap: 20px;
        }

        .score, .best-score {
            background: #1e1e1e;
            padding: 10px 15px;
            border-radius: 6px;
            text-align: center;
        }

        .score-value, .best-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #bb86fc;
        }

        .score-label, .best-label {
            font-size: 0.9rem;
            color: #aaa;
        }

        .game-2048-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            background-color: #2a2a2a;
            border: 2px solid #2a2a2a;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1 / 1;
            padding: 10px;
            border-radius: 6px;
        }

        .cell {
            background-color: #3a3a3a;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            user-select: none;
            transition: all 0.15s;
        }

        /* Цвета для разных значений плиток */
        .cell-0 { background-color: #3a3a3a; color: transparent; }
        .cell-2 { background-color: #2d2d5a; color: #e0e0e0; }
        .cell-4 { background-color: #2d3a5a; color: #e0e0e0; }
        .cell-8 { background-color: #2d5a4a; color: #e0e0e0; }
        .cell-16 { background-color: #5a5a2d; color: #e0e0e0; }
        .cell-32 { background-color: #5a3a2d; color: #e0e0e0; }
        .cell-64 { background-color: #5a2d2d; color: #e0e0e0; }
        .cell-128 { background-color: #3d2d5a; color: #e0e0e0; font-size: 1.6rem; }
        .cell-256 { background-color: #2d5a5a; color: #e0e0e0; font-size: 1.6rem; box-shadow: 0 0 10px #bb86fc; }
        .cell-512 { background-color: #5a2d5a; color: #e0e0e0; font-size: 1.6rem; box-shadow: 0 0 10px #bb86fc; }
        .cell-1024 { background-color: #2d5a3d; color: #e0e0e0; font-size: 1.4rem; box-shadow: 0 0 15px #bb86fc; }
        .cell-2048 { background-color: #bb86fc; color: #121212; font-size: 1.4rem; box-shadow: 0 0 20px #bb86fc; }

        .game-status {
            margin-top: 10px;
            font-size: 1.1rem;
            height: 24px;
            text-align: center;
        }

        .game-over {
            color: #ff5252;
            font-weight: bold;
        }

        .game-won {
            color: #4caf50;
            font-weight: bold;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .action-btn {
            background: #333;
            color: #e0e0e0;
            border: none;
            padding: 12px 0;
            font-size: 1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .action-btn:hover {
            background: #444;
        }

        .action-btn.primary {
            background: #bb86fc;
            color: #121212;
        }

        .action-btn.primary:hover {
            background: #9d6ad8;
        }

        .instructions {
            margin-top: 10px;
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
        }

        @keyframes new-tile {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes merge-tile {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .new-tile {
            animation: new-tile 0.2s ease-out;
        }

        .merged-tile {
            animation: merge-tile 0.2s ease-out;
        }

        @media (max-width: 500px) {
            .game-2048-board {
                max-width: 100%;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .settings {
                flex-direction: column;
                gap: 10px;
            }
            
            .cell {
                font-size: 1.5rem;
            }
            
            .cell-128, .cell-256, .cell-512 {
                font-size: 1.3rem;
            }
            
            .cell-1024, .cell-2048 {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="title">2048</h1>
            <div class="settings">
                <div class="language-selector">
                    <button class="lang-btn active" data-lang="ru">RU</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </div>
            </div>
        </header>
        
        <div class="game-info">
            <div class="score-container">
                <div class="score">
                    <div class="score-label" id="score-label">Счет</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="best-score">
                    <div class="best-label" id="best-label">Рекорд</div>
                    <div class="best-value" id="best-score">0</div>
                </div>
            </div>
        </div>
        
        <div class="game-2048-board" id="game-2048-board">
            <!-- Клетки будут созданы через JS -->
        </div>
        
        <div class="game-status" id="game-status"></div>
        
        <div class="controls">
            <div class="action-buttons">
                <button class="action-btn" id="undo-btn">Отменить</button>
                <button class="action-btn primary" id="new-game-btn">Новая игра</button>
            </div>
        </div>
        
        <div class="instructions" id="instructions">
            Используйте стрелки или свайпы для перемещения плиток
        </div>
    </div>

    <script>
        // Тексты на разных языках
        const translations = {
            ru: {
                title: "2048",
                score: "Счет",
                best: "Рекорд",
                newGame: "Новая игра",
                undo: "Отменить",
                gameOver: "Игра окончена!",
                youWin: "Поздравляем! Вы достигли 2048!",
                continue: "Продолжить игру",
                instructions: "Используйте стрелки или свайпы для перемещения плиток"
            },
            en: {
                title: "2048",
                score: "Score",
                best: "Best",
                newGame: "New Game",
                undo: "Undo",
                gameOver: "Game Over!",
                youWin: "Congratulations! You reached 2048!",
                continue: "Continue Playing",
                instructions: "Use arrow keys or swipe to move tiles"
            }
        };

        // Текущий язык
        let currentLanguage = 'ru';

        // Элементы DOM
        const titleElement = document.getElementById('title');
        const scoreElement = document.getElementById('score');
        const bestScoreElement = document.getElementById('best-score');
        const scoreLabelElement = document.getElementById('score-label');
        const bestLabelElement = document.getElementById('best-label');
        const gameBoard = document.getElementById('game-2048-board');
        const undoBtn = document.getElementById('undo-btn');
        const newGameBtn = document.getElementById('new-game-btn');
        const gameStatus = document.getElementById('game-status');
        const instructionsElement = document.getElementById('instructions');
        const langButtons = document.querySelectorAll('.lang-btn');

        // Состояние игры
        let board = [];
        let score = 0;
        let bestScore = 0;
        let gameActive = true;
        let moved = false;
        let history = [];

        // Размеры доски
        const size = 4;

        // Инициализация игры
        function initGame() {
            createBoard();
            loadBestScore();
            updateUI();
            addNewTile();
            addNewTile();
            renderBoard();
            
            // Добавляем обработчики событий
            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    setLanguage(btn.dataset.lang);
                });
            });
            
            newGameBtn.addEventListener('click', startNewGame);
            undoBtn.addEventListener('click', undoMove);
            
            // Обработчики клавиатуры
            document.addEventListener('keydown', handleKeyPress);
            
            // Обработчики для свайпов на мобильных
            setupTouchControls();
        }

        // Создание игрового поля
        function createBoard() {
            gameBoard.innerHTML = '';
            
            // Создаем клетки
            for (let i = 0; i < size * size; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell', 'cell-0');
                gameBoard.appendChild(cell);
            }
            
            // Инициализируем пустую доску
            board = Array(size).fill().map(() => Array(size).fill(0));
        }

        // Добавление новой плитки
        function addNewTile() {
            const emptyCells = [];
            
            // Находим все пустые клетки
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (board[i][j] === 0) {
                        emptyCells.push({row: i, col: j});
                    }
                }
            }
            
            if (emptyCells.length > 0) {
                // Выбираем случайную пустую клетку
                const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                
                // С вероятностью 90% добавляем 2, с вероятностью 10% - 4
                board[randomCell.row][randomCell.col] = Math.random() < 0.9 ? 2 : 4;
                
                // Анимация появления новой плитки
                const cellIndex = randomCell.row * size + randomCell.col;
                const cellElement = gameBoard.children[cellIndex];
                cellElement.classList.add('new-tile');
                setTimeout(() => cellElement.classList.remove('new-tile'), 200);
                
                return true;
            }
            
            return false;
        }

        // Отрисовка доски
        function renderBoard() {
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const cellIndex = i * size + j;
                    const cellElement = gameBoard.children[cellIndex];
                    const value = board[i][j];
                    
                    // Обновляем класс и текст
                    cellElement.className = 'cell';
                    cellElement.classList.add(`cell-${value}`);
                    
                    if (value === 0) {
                        cellElement.textContent = '';
                    } else {
                        cellElement.textContent = value;
                    }
                }
            }
        }

        // Сохранение состояния для отмены хода
        function saveState() {
            history.push({
                board: JSON.parse(JSON.stringify(board)),
                score: score
            });
            
            // Ограничиваем историю последними 10 ходами
            if (history.length > 10) {
                history.shift();
            }
        }

        // Отмена хода
        function undoMove() {
            if (history.length > 0) {
                const prevState = history.pop();
                board = prevState.board;
                score = prevState.score;
                renderBoard();
                updateScore();
                gameActive = true;
                gameStatus.textContent = '';
            }
        }

        // Обработка нажатия клавиш
        function handleKeyPress(event) {
            if (!gameActive) return;
            
            saveState();
            moved = false;
            
            switch(event.key) {
                case 'ArrowUp':
                    moveUp();
                    break;
                case 'ArrowDown':
                    moveDown();
                    break;
                case 'ArrowLeft':
                    moveLeft();
                    break;
                case 'ArrowRight':
                    moveRight();
                    break;
                default:
                    return; // Игнорируем другие клавиши
            }
            
            if (moved) {
                addNewTile();
                renderBoard();
                updateScore();
                checkGameStatus();
            }
        }

        // Движение вверх
        function moveUp() {
            for (let j = 0; j < size; j++) {
                for (let i = 1; i < size; i++) {
                    if (board[i][j] !== 0) {
                        let row = i;
                        while (row > 0 && board[row - 1][j] === 0) {
                            board[row - 1][j] = board[row][j];
                            board[row][j] = 0;
                            row--;
                            moved = true;
                        }
                        
                        if (row > 0 && board[row - 1][j] === board[row][j]) {
                            board[row - 1][j] *= 2;
                            score += board[row - 1][j];
                            board[row][j] = 0;
                            moved = true;
                            
                            // Анимация слияния
                            const cellIndex = (row - 1) * size + j;
                            const cellElement = gameBoard.children[cellIndex];
                            cellElement.classList.add('merged-tile');
                            setTimeout(() => cellElement.classList.remove('merged-tile'), 200);
                        }
                    }
                }
            }
        }

        // Движение вниз
        function moveDown() {
            for (let j = 0; j < size; j++) {
                for (let i = size - 2; i >= 0; i--) {
                    if (board[i][j] !== 0) {
                        let row = i;
                        while (row < size - 1 && board[row + 1][j] === 0) {
                            board[row + 1][j] = board[row][j];
                            board[row][j] = 0;
                            row++;
                            moved = true;
                        }
                        
                        if (row < size - 1 && board[row + 1][j] === board[row][j]) {
                            board[row + 1][j] *= 2;
                            score += board[row + 1][j];
                            board[row][j] = 0;
                            moved = true;
                            
                            // Анимация слияния
                            const cellIndex = (row + 1) * size + j;
                            const cellElement = gameBoard.children[cellIndex];
                            cellElement.classList.add('merged-tile');
                            setTimeout(() => cellElement.classList.remove('merged-tile'), 200);
                        }
                    }
                }
            }
        }

        // Движение влево
        function moveLeft() {
            for (let i = 0; i < size; i++) {
                for (let j = 1; j < size; j++) {
                    if (board[i][j] !== 0) {
                        let col = j;
                        while (col > 0 && board[i][col - 1] === 0) {
                            board[i][col - 1] = board[i][col];
                            board[i][col] = 0;
                            col--;
                            moved = true;
                        }
                        
                        if (col > 0 && board[i][col - 1] === board[i][col]) {
                            board[i][col - 1] *= 2;
                            score += board[i][col - 1];
                            board[i][col] = 0;
                            moved = true;
                            
                            // Анимация слияния
                            const cellIndex = i * size + (col - 1);
                            const cellElement = gameBoard.children[cellIndex];
                            cellElement.classList.add('merged-tile');
                            setTimeout(() => cellElement.classList.remove('merged-tile'), 200);
                        }
                    }
                }
            }
        }

        // Движение вправо
        function moveRight() {
            for (let i = 0; i < size; i++) {
                for (let j = size - 2; j >= 0; j--) {
                    if (board[i][j] !== 0) {
                        let col = j;
                        while (col < size - 1 && board[i][col + 1] === 0) {
                            board[i][col + 1] = board[i][col];
                            board[i][col] = 0;
                            col++;
                            moved = true;
                        }
                        
                        if (col < size - 1 && board[i][col + 1] === board[i][col]) {
                            board[i][col + 1] *= 2;
                            score += board[i][col + 1];
                            board[i][col] = 0;
                            moved = true;
                            
                            // Анимация слияния
                            const cellIndex = i * size + (col + 1);
                            const cellElement = gameBoard.children[cellIndex];
                            cellElement.classList.add('merged-tile');
                            setTimeout(() => cellElement.classList.remove('merged-tile'), 200);
                        }
                    }
                }
            }
        }

        // Проверка статуса игры
        function checkGameStatus() {
            // Проверка на победу
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (board[i][j] === 2048) {
                        gameStatus.textContent = translations[currentLanguage].youWin;
                        gameStatus.classList.add('game-won');
                        gameActive = false;
                        return;
                    }
                }
            }
            
            // Проверка на возможность ходов
            if (!canMove()) {
                gameStatus.textContent = translations[currentLanguage].gameOver;
                gameStatus.classList.add('game-over');
                gameActive = false;
            }
        }

        // Проверка возможности хода
        function canMove() {
            // Проверка пустых клеток
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (board[i][j] === 0) {
                        return true;
                    }
                }
            }
            
            // Проверка возможных слияний
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const current = board[i][j];
                    
                    // Проверка соседей
                    if (i < size - 1 && board[i + 1][j] === current) return true;
                    if (j < size - 1 && board[i][j + 1] === current) return true;
                }
            }
            
            return false;
        }

        // Обновление счета
        function updateScore() {
            scoreElement.textContent = score;
            
            if (score > bestScore) {
                bestScore = score;
                bestScoreElement.textContent = bestScore;
                localStorage.setItem('2048-best-score', bestScore);
            }
        }

        // Загрузка рекорда
        function loadBestScore() {
            const savedBest = localStorage.getItem('2048-best-score');
            if (savedBest) {
                bestScore = parseInt(savedBest);
                bestScoreElement.textContent = bestScore;
            }
        }

        // Настройка управления свайпами
        function setupTouchControls() {
            let startX, startY;
            const minSwipeDistance = 50;
            
            document.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });
            
            document.addEventListener('touchend', (e) => {
                if (!startX || !startY || !gameActive) return;
                
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                
                const diffX = startX - endX;
                const diffY = startY - endY;
                
                // Определяем направление свайпа
                if (Math.abs(diffX) > Math.abs(diffY)) {
                    // Горизонтальный свайп
                    if (Math.abs(diffX) > minSwipeDistance) {
                        saveState();
                        moved = false;
                        
                        if (diffX > 0) {
                            moveLeft();
                        } else {
                            moveRight();
                        }
                    }
                } else {
                    // Вертикальный свайп
                    if (Math.abs(diffY) > minSwipeDistance) {
                        saveState();
                        moved = false;
                        
                        if (diffY > 0) {
                            moveUp();
                        } else {
                            moveDown();
                        }
                    }
                }
                
                if (moved) {
                    addNewTile();
                    renderBoard();
                    updateScore();
                    checkGameStatus();
                }
                
                startX = null;
                startY = null;
            });
        }

        // Новая игра
        function startNewGame() {
            board = Array(size).fill().map(() => Array(size).fill(0));
            score = 0;
            gameActive = true;
            history = [];
            
            updateScore();
            gameStatus.textContent = '';
            gameStatus.classList.remove('game-over', 'game-won');
            
            addNewTile();
            addNewTile();
            renderBoard();
        }

        // Установка языка
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Обновляем активную кнопку языка
            langButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // Обновляем тексты
            updateUI();
        }

        // Обновление интерфейса
        function updateUI() {
            titleElement.textContent = translations[currentLanguage].title;
            scoreLabelElement.textContent = translations[currentLanguage].score;
            bestLabelElement.textContent = translations[currentLanguage].best;
            undoBtn.textContent = translations[currentLanguage].undo;
            newGameBtn.textContent = translations[currentLanguage].newGame;
            instructionsElement.textContent = translations[currentLanguage].instructions;
            
            if (gameStatus.classList.contains('game-over')) {
                gameStatus.textContent = translations[currentLanguage].gameOver;
            } else if (gameStatus.classList.contains('game-won')) {
                gameStatus.textContent = translations[currentLanguage].youWin;
            }
        }

        // Запуск игры при загрузке страницы
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
